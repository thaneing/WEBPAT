@{
    ViewData["Title"] = "ปฏิทินการนัด";
    ViewData["Tab"] = "<ol class='breadcrumb'>"
               + "<li>"
               + "<a href='../../Home/Index'>Home</a>"
               + "</li>"
               + "<li>"
               + "<a href='/Blogs/Index'>Recruit Data</a>"
               + "</li>"
               + "<li class='active'>"
               + "<a>" + @ViewData["Title"] + "</a>"
               + "</li>"
               + "</ol>";
}


@model CESAPSCOREWEBAPP.Models.HRRecruite


<div class="col-xs-12 col-sm-12  col-md-12 col-lg-8">
    <div class="ibox float-e-margins">
        <div class="ibox-title">
            <h5>@ViewData["Title"]</h5>
            <div class="ibox-tools">
                <a class="collapse-link">
                    <i class="fa fa-chevron-up"></i>
                </a>
                <a class="close-link">
                    <i class="fa fa-times"></i>
                </a>
            </div>
        </div>
        <div class="ibox-content">
            <div id="calender"></div>
        </div>
    </div>
</div>




<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title"><span id="eventTitle"></span></h4>
            </div>
            <div class="modal-body">
                <p id="pDetails"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>




<div class="col-xs-12 col-sm-12  col-md-12 col-lg-4">
    <div class="ibox float-e-margins">
        <div class="ibox-title">
            <h5>สรุปข้อมูลการนัด</h5>
            <div class="ibox-tools">
                <a class="collapse-link">
                    <i class="fa fa-chevron-up"></i>
                </a>
                <a class="close-link">
                    <i class="fa fa-times"></i>
                </a>
            </div>
        </div>
        <div class="ibox-content">
            <div class="table-responsive">

                <table id="example" class="table table-striped table-bordered table-hover dataTables-example">
                    <thead>
                        <tr>
                            <th>Week</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>







    @section Scripts {

        <script>
            $(document).ready(function () {
                var dataType = 'application/json; charset=utf-8';
                var events = [];


                var selectedEvent = null;
                FetchEventAndRenderCalendar();
                function FetchEventAndRenderCalendar() {
                    events = [];
                    $.ajax({
                        type: "GET",
                        url: "/HRRecruites/GetEvents",
                        success: function (data) {
                            $.each(data, function (i, v) {
                                events.push({
                                    Id: v.Id,
                                    title: v.Subject,
                                    description: v.Description,
                                    start: moment(v.Start),
                                    end: v.End != null ? moment(v.End) : null,
                                    color: v.ThemeColor,
                                    allDay: false
                                });



                            })
                            GenerateCalender(events);
                        },
                        error: function (error) {
                            alert('failed');
                        }
                    })
                }

                function GenerateCalender(events) {
                    $('#calender').fullCalendar('destroy');
                    $('#calender').fullCalendar({
                        contentHeight: 800,
                        defaultDate: new Date(),
                        timeFormat: 'HH:mm',
                        header: {
                            close: 'fa-times',
                            prev: 'fa-chevron-left',
                            next: 'fa-chevron-right',
                            prevYear: 'fa-angle-double-left',
                            nextYear: 'fa-angle-double-right'
                        },
                        eventLimit: true,
                        eventColor: '#378006',
                        events: events,
                        eventClick: function (calEvent, jsEvent, view) {
                            selectedEvent = calEvent;
                            $('#myModal #eventTitle').text(calEvent.title);
                            var $description = $('<div/>');
                            $description.append($('<p/>').html('<b>วันที่นัด : </b>' + calEvent.start.format("DD/MM/YYYY HH:mm:ss")));
                            if (calEvent.end != null) {
                                $description.append($('<p/>').html('<b>ถึง : </b>' + calEvent.end.format("DD/MMM/YYYY HH:mm:ss")));
                            }
                            $description.append($('<p/>').html('<b>Description:</b>' + calEvent.description));
                            $('#myModal #pDetails').empty().html($description);
                            $('#myModal').modal();
                        },
                        selectable: true,
                        select: function (start, end) {
                            selectedEvent = {
                                Id: 0,
                                title: '',
                                description: '',
                                start: start,
                                end: end,
                                allDay: false,
                                color: ''
                            };
                            openAddEditForm();
                            $('#calendar').fullCalendar('unselect');
                        },
                        editable: false

                    })
                }

                //alert(item);
                var dataType = 'application/json; charset=utf-8';
                table = $('#example').DataTable({
                    destroy: true,
                    columnDefs:
                        [
                            {
                                targets: -1,
                                className: 'dt-body-right'
                            }



                        ],
                    "language": {
                        "decimal": ",",
                        "thousands": "."
                    },

                      "bPaginate": false,
                    "bLengthChange": false,
                    "bFilter": true,
                    "bInfo": false,
                    "bAutoWidth": false,

                    responsive: true,

                     dom: '<"html5buttons"B>lTfgitp',

                    buttons: [


                        {
                            extend: 'pdfHtml5',
                            text: '<i class="fa fa-file-pdf-o"></i> PDF',
                            titleAttr: 'PDF',
                            pageSize: 'A4',   // ขนาดหน้ากระดาษเป็น A4
                            //orientation: 'landscape',

                            customize: function (doc) {
                                doc.defaultStyle = {
                                    font: 'THSarabun',
                                    fontSize: '12',

                                };
                                var now = new Date();
                                var jsDate = now.getDate() + '-' + (now.getMonth() + 1) + '-' + now.getFullYear();
                                doc['footer'] = (function (page, pages) {
                                    return {
                                        columns:
                                            [
                                                {
                                                    alignment: 'center',
                                                    text: ['Created on: ', { text: jsDate.toString() }]
                                                },
                                                {
                                                    alignment: 'right',
                                                    text: ['page ', { text: page.toString() }, ' of ', { text: pages.toString() }]
                                                }
                                            ],
                                        margin: 10
                                    }
                                });
                            }
                        },
                        {
                            extend: 'excelHtml5',
                            text: '<i class="fa fa-file-excel-o"></i> Excel',
                            titleAttr: 'Excel',
                            autoFilter: true
                        }

                    ],
                    "ajax": {
                        "url": "/HRRecruites/GetSumWeek/?year=2019",
                        "contentType": dataType,
                        "type": "GET",
                        "data": function (response) {
                            return JSON.stringify(response.data);
                        }

                    },
                    "columns": [
                        { "data": "X" },
                        { "data": "Y" }
                    ]

                });







            })





        </script>

    }

